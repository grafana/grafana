apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: outages.monitoring.grafana.app
spec:
  group: monitoring.grafana.app
  names:
    kind: Outage
    listKind: OutageList
    plural: outages
    singular: outage
    shortNames:
      - out
  scope: Cluster  # ‚Üê CLUSTER-SCOPED (not namespaced)
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              properties:
                region:
                  type: string
                  description: Geographic region affected by the outage
                  enum:
                    - us-east-1
                    - us-west-2
                    - eu-west-1
                    - eu-central-1
                    - ap-southeast-1
                    - ap-northeast-1
                severity:
                  type: string
                  description: Severity level of the outage
                  enum:
                    - critical
                    - major
                    - minor
                  default: major
                affectedServices:
                  type: array
                  description: List of services affected
                  items:
                    type: string
                startTime:
                  type: string
                  format: date-time
                  description: When the outage started
                description:
                  type: string
                  description: Description of the outage
              required:
                - region
                - severity
                - startTime
            status:
              type: object
              properties:
                resolved:
                  type: boolean
                  description: Whether the outage has been resolved
                resolvedAt:
                  type: string
                  format: date-time
                  description: When the outage was resolved
                affectedCustomers:
                  type: integer
                  description: Number of customers affected
                updates:
                  type: array
                  description: Status updates
                  items:
                    type: object
                    properties:
                      timestamp:
                        type: string
                        format: date-time
                      message:
                        type: string
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Region
          type: string
          description: Geographic region
          jsonPath: .spec.region
        - name: Severity
          type: string
          description: Severity level
          jsonPath: .spec.severity
        - name: Resolved
          type: boolean
          description: Resolution status
          jsonPath: .status.resolved
        - name: Start Time
          type: date
          description: When the outage started
          jsonPath: .spec.startTime
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
