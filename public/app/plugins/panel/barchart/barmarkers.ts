import { UPlotConfigBuilder } from '@grafana/ui';
import uPlot from 'uplot';


// Code generated by copilot
export type BarMarkerDetails = {
  opts: BarMarkerOpts;
  loc: Location;
};


type BarMarkerOpts = {
    Label: string;
    Width: number,
    Color: string,
  // Shape?: 'circle' | 'square' | 'diamond' | 'cross';
};

type Location = {
    x: number,
    y: number,
};

type BarMarker = {
    opts: BarMarkerOpts;
    barSeriesIndex: number; // index of the bar/group to mark based on it's series index
};

/**
 * Registers a draw hook that paints a short horizontal tick on a single bar/group center.
 * IMPORTANT: Call this BEFORE the first builder.getConfig() (i.e., before <UPlotChart> mounts),
 * because builder caches the config.
 */
export function singleBarMarker(builder: UPlotConfigBuilder) {
    return barMarkersBuilder(barMarkerDetails) // use some default opts for now
}

//PLACEHOLDER: to be replaced 
export const barMarkerDetails: BarMarkerDetails[] = [
  {
    opts: {
      Label: 'Marker',
      Width: 200,
      Color: 'red',
    },
    loc: {
      x: 200,
      y: 500,
    },
  },
    {
      opts: {
        Label: 'Marker2',
        Width: 200,
        Color: 'red',
      },
      loc: {
        x: 600,
        y: 500,
      },
    },
];



export function CalculateMarkerPosition(){
  // calculate x,y position based on data?
  return barMarkerDetails;
}

export function barMarkersBuilder(opts: BarMarkerDetails[]){
  
  return (u: uPlot) => {
    if (!u.ctx) {
      console.warn("No canvas context available");
      return;
    }
    const ctx = u.ctx;

    ctx.save();
    for (let i=0; i<opts.length; i++){
      // Code generated by copilot
            ctx.strokeStyle = opts[i].opts.Color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(opts[i].loc.x - opts[i].opts.Width/2, opts[i].loc.y);
            ctx.lineTo(opts[i].loc.x + opts[i].opts.Width/2, opts[i].loc.y);
      // End of copilot-generated code
      
      ctx.stroke();
    }
    ctx.restore();
}
}
