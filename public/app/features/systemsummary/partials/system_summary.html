<div dash-class ng-if="dashboard">
    <dashnav></dashnav>

    <div class="dashboard-container">

        <div dash-editor-view></div>
        <dashboard-search></dashboard-search>
        <div class="clearfix"></div>

        <dashboard-submenu ng-if="submenuEnabled" dashboard="dashboard"></dashboard-submenu>

        <div class="clearfix"></div>

        <div class="grafana-row" ng-controller="RowCtrl" ng-repeat="(row_name, row) in dashboard.rows" row-height>
            <div class="row-control">
                <div class="row-control-inner">
                    <div class="row-close" ng-show="row.collapse" data-placement="bottom" >
                        <div class="row-close-buttons">
							<span class="row-button" ng-click="toggleRow(row)">
								<i bs-tooltip="'Expand row'" data-placement="right" class="fa fa-caret-left pointer" ></i>
							</span>
                        </div>
                        <div class="row-text pointer" ng-click="toggleRow(row)" ng-bind="row.title | interpolateTemplateVars:this"></div>
                    </div>
                    <div class="row-open" ng-show="!row.collapse">
                        <div class='row-tab dropdown' ng-show="dashboardMeta.canEdit" ng-hide="dashboard.meta.fullscreen">
							<span class="row-tab-button dropdown-toggle" data-toggle="dropdown">
								<i class="fa fa-bars"></i>
							</span>
                            <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="drop1">
                                <li>
                                    <a ng-click="toggleRow(row)">合并行</a>
                                </li>
                                <li class="dropdown-submenu">
                                    <a href="javascript:void(0);">添加模块</a>
                                    <ul class="dropdown-menu">
                                        <li bindonce ng-repeat="(key, value) in panels">
                                            <a ng-click="addPanelDefault(key)" bo-text="value.name"></a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a href="javascript:void(0);">设置高度</a>
                                    <ul class="dropdown-menu">
                                        <li><a ng-click="setHeight('25px')">25 px</a></li>
                                        <li><a ng-click="setHeight('100px')">100 px</a></li>
                                        <li><a ng-click="setHeight('150px')">150 px</a></li>
                                        <li><a ng-click="setHeight('200px')">200 px</a></li>
                                        <li><a ng-click="setHeight('250px')">250 px</a></li>
                                        <li><a ng-click="setHeight('300px')">300 px</a></li>
                                        <li><a ng-click="setHeight('350px')">350 px</a></li>
                                        <li><a ng-click="setHeight('450px')">450 px</a></li>
                                        <li><a ng-click="setHeight('500px')">500 px</a></li>
                                        <li><a ng-click="setHeight('600px')">600 px</a></li>
                                        <li><a ng-click="setHeight('700px')">700 px</a></li>
                                    </ul>
                                </li>
                                <li class="dropdown-submenu">
                                    <a href="javascript:void(0);">移动</a>
                                    <ul class="dropdown-menu">
                                        <li><a ng-click="moveRow('up')">上移</a></li>
                                        <li><a ng-click="moveRow('down')">下移</a></li>
                                        <li><a ng-click="moveRow('top')">置顶</a></li>
                                        <li><a ng-click="moveRow('bottom')">置底</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a ng-click="editRow()">行编辑</a>
                                </li>
                                <li>
                                    <a ng-click="deleteRow()">删除整行</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="panels-wrapper" ng-if="!row.collapse">
                    <div class="row-close-buttons" ng-if="row.showTitle">
						<span class="row-button bgPrimary" ng-click="toggleRow(row)">
							<i bs-tooltip="'Expand row'" data-placement="right" class="fa fa-caret-down pointer" ></i>
						</span>
                    </div>
                    <div class="row-text pointer" ng-click="toggleRow(row)" ng-if="row.showTitle" ng-bind="row.title | interpolateTemplateVars:this">
                    </div>

                    <div ng-repeat="panel in row.panels track by panel.id" class="panel" ui-draggable="!dashboard.meta.fullscreen" drag="panel.id"
                         ui-on-drop="onDrop($data, row, panel)" drag-handle-class="drag-handle" panel-width>
                        <div style="padding-left: 10px;" ng-if="row.title == '健康指数趋势'">
                            <div style="height: 60px">
                                <em style="font-size: 60px;line-height:66px;font-style: normal">{{applicationHealth}}</em>
                                <span>{{leveal}}</span>
                            </div>
                            <br>
                            <p>自动检测到所有<strong>{{ summary.numMetrics }}</strong>个指标中: 告警指标 <strong>{{ summary.numAlertsTriggered }}</strong>个  异常指标 <strong>{{ summary.numAnomalyMetrics }}</strong>个 <tip>健康值=(告警指标个数/定义规则总数)*50% + (异常指标/所有指标) * 50%</tip></p>
                        </div>
                        <ul class="btn-list-status" ng-if="panel.status">
                            <li class="btn-item" style="width:70px;">当前状态:</li>
                            <li ng-if="panel.status.danger[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-danger">{{panel.status.danger[0]}} <span>{{panel.status.danger[1]}}</span></a></li>
                            <li ng-if="panel.status.warn[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-warning">{{panel.status.warn[0]}} <span>{{panel.status.warn[1]}}</span></a></li>
                            <li ng-if="panel.status.success[1]!=0"><a href="{{panel.href}}" class="btn-item system-status system-status-success">{{panel.status.success[0]}} <span>{{panel.status.success[1]}}</span></a></li>
                        </ul>
                        <div class="clearfix"></div>
                        <plugin-component type="panel" class="panel-margin">
                        </plugin-component>
                        <p ng-if="panel.tip"><i class="fa fa-info-circle" style="padding:0 10px;"></i>
                            <span ng-if="panel.tips.length">预计未来</span>
                            <select ng-if="panel.tips.length" style="width:66px;"
                                    ng-model="panel.selectedOption"
                                    ng-change="changePre(panel.selectedOption)"
                                    ng-options="tip.time for tip in panel.tips">
                            </select>
                            {{panel.tip + panel.selectedOption.data}}
                        </p>
                    </div>

                    <div panel-drop-zone class="panel panel-drop-zone" ui-on-drop="onDrop($data, row)" data-drop="true">
                        <div class="panel-container" style="background: transparent">
                            <div style="text-align: center">
                                <em>Drop here</em>
                            </div>
                        </div>
                    </div>

                    <div class="clearfix"></div>
                </div>
            </div>
        </div>

        <div ng-show='dashboardMeta.canEdit' class="row-fluid add-row-panel-hint" ng-hide="dashboard.meta.fullscreen">
            <div class="span12" style="text-align:right;">
				<span style="margin-right: 10px;" ng-click="addRowDefault()" class="pointer btn btn-secondary btn-small">
					<span><i class="fa fa-plus"></i> 新增一行</span>
				</span>
            </div>
        </div>
    </div>
</div>
